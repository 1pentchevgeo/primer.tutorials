Testing tutorials is tricky.

First, we would like to test files which are not yet installed. With test() (from devtools), things work fine. You can just use relative paths because the tests seem to be run from where the test files live. With check(), this fails. It is as if the tests are run from a different directory, so "../../inst" does not point to the current inst directory. So, the only choice is to use system.file(), as we are currently.

Something like this works fine with test() but not with check().

files <- fs::dir_ls("../../inst", recurse = TRUE, regexp = "tutorial.Rmd")

Second, any code in a tutorial code chunk, including in a hint, which produces an error when run on its own will cause an error if you use R CMD check. Most common example is when you have ... to indicate to the student that they should replace the ... with something. Best solution is to set eval = FALSE in all hint chunks like this. But the same warning applies for all chunks.

Testing is hard. There are (at least) two different environments in which we
run tests. First, and most important, is when we run R CMD check. This is the
most rigorous check. It requires that code written in all code chunks
(including hints) work correctly. So, you can't just have things like
library(...) around, even though that is an extremely convenient way to
indicate to the student that they need to use the library function with some
argument.

The second environment is when you press "Test Package". I think that all this
does is to source tests/testthat.R. (And this environment is (mostly) the same
as when you just execute tests interactively. At least, the two give the same
answer.) But, in this second case, the code in hint (and all other?) chunks is
not evaluated. The same problem arises if you just use "Run Document," as
students will do (in effect) when the press Start Tutorial.

I think that, in order to simulate the test that is run with R CMD check, you
need, from the R Console, to type:

rmarkdown::render("inst/tutorials/03-functions-A/tutorial.Rmd")

