---
title: "Wrangling C"
tutorial:
  id: "wrangling-c"
output:
  learnr::tutorial:
      progressive: true
      allow_skip: true
runtime: shiny_prerendered
description: "Chapter 2: Wrangling -- C"
---

```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(lubridate)
library(stringr)
library(skimr)
library(primer.data)
library(ggdist)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 
library(ggthemes)
```

<!-- There is something wrong with this file, which is causing it to fail R CMD check. So, I renamed it to problem.Rmd. You can still Run Document the file and it works fine. But the fact that it is not named tutorial.Rmd means that our test script does not try (and fail) to test it. Good enough for now. -->

<!-- Start with a geom_histogram example, but which looks like a standard plot. Or, maybe just use facet_wrap, stack them on top of each other. Raw counts of things are important. -->

<!-- Second plot, use the same data, turns it into percentages using the after_stat() trickery. -->

<!-- Third plot, use the same data, does this with geom_density(). Just an easier way of showing those shapes. -->

<!-- Fourth plot, same data, use stat_slab().  -->

<!-- Next three plots use different data (with, one hopes, some wrangling) and then different stat_slab(). (At least one should be dot plots. And one should be vertical.) -->

<!-- Five examples, each of which needs to use pivot_longer (if needed) to put things in the same column and which then creates a "standard" plot with different levels on the y-axis. Those levels sometimes already exist in the data, like trains$party, and sometimes need to be created, like turning trains$income into 5 categories.  -->

<!-- Use stuff other than stat_slab() for variety sake. Use geom_density in the first plot, maybe. And then geom_histogram() in the second plot, maybe with the same data! -->

<!-- Drop knuggets of wisdom about what these densities mean. Sometimes they are scaled and sometimes not. -->

<!-- Example with trains which needs to get att_end and att_start in the same column so that you can plot them together with fill or whatever. -->

<!-- Example with trains which transform income into a set of categories, as in class.  -->


## Information
###

```{r information}
quiz(caption = "",
  question_text(
    "Name:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL),
  question_text(
    "Email:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL))
```

## National Health and Nutrition Survey
###

`nhanes` includes data from the "National Health and Nutrition Examination Survey," which contains the personal and physical information of 10,000 Americans from two surveys in 2009 and 2011.

###

Let's create the following plot.

```{r}
nhanes_p <- nhanes %>% 
  select(bmi, gender, depressed) %>% 
  drop_na(depressed, bmi) %>% 
  ggplot(aes(x = bmi, y = depressed, fill = gender)) +
  stat_slab(alpha = .5) +
  coord_cartesian(xlim = c(16, 60)) +
  labs(title = "BMI and Depression",
       subtitle = "Correlation between depression and BMI varies with sex", 
       x = "BMI", 
       y = "Depression", 
       fill = "Sex",
       caption = "National Health and Nutrition Examination Survey") +
  theme_classic() 

nhanes_p
```

### Exercise 1

`skim()` the `nhanes` data set.

```{r nhanes1, exercise = TRUE}

```

```{r nhanes1-hint, eval = FALSE}
skim(...)
```

### Exercise 2

Now `select()` the `gender`, `depressed`, and `bmi` columns. 

```{r nhanes3, exercise = TRUE}

```

```{r nhanes3-hint, eval = FALSE}
... %>%
  select(..., ..., ...)
```

### Exercise 4

`nhanes` has NA values in some rows. Start a pipe with `nhanes`. Use `drop_na()` with the arguments `bmi`and `depressed` to remove all rows with a value of NA in the those columns.

```{r nhanes4, exercise = TRUE}

```

```{r nhanes4-hint, eval = FALSE}
... %>%
  drop_na(..., ...)
```

### Exercise 5

Continue you pipe with `ggplot()`. Also add the layer `stat_slab()` to make a chart of histograms. Map `bmi` to the x-axis, `depressed` to the y-axis, and `gender` to `fill`.

```{r nhanes5, exercise = TRUE}

```


```{r nhanes5-hint, eval = FALSE}
... %>% 
  ggplot(data = ..., aes(x = ..., 
                        y = ..., 
                        fill = ...)) +
  stat_slab()
```

### Exercise 6

The graphs overlap. Within `stat_slab()`, set the `alpha` argument to be equal to 0.5. 

```{r nhanes6, exercise = TRUE}

```

```{r nhanes6-hint, eval = FALSE}
... + 
  geom_smooth(alpha  = 0.5)
```

### Exercise 7

The x axis domain includes numbers not in the range of BMI. Add the layer `coord_cartesian()` and set the `xlim` argument to the vector `c(16, 60)`, so that the domain has a minimum of 16 and a maximum of 60. 

```{r nhanes7, exercise = TRUE}

```

```{r nhanes7-hint, eval = FALSE}
... +
  stat_slab(alpha = .5) +
  coord_cartesian(xlim = c(16, 60))
```

### Exercise 8

Adjust the feel of the graph by adding the theme `theme_clean()`.

```{r nhanes8, exercise = TRUE}

```

```{r nhanes8-hint-1, eval = FALSE}
Recall that when you add a theme, you add a layer! Use the + operator.
```

```{r nhanes8-hint-2, eval = FALSE}
... +
  theme_clean()
```

### Exercise 10

To finish your plot, use `labs()` to give the graph a title, subtitle, axis labels, and caption of your choice. Reminder: This is what your plot should look like.

```{r nhanes10-answer}
nhanes_p
```

```{r nhanes10, exercise = TRUE}

```



