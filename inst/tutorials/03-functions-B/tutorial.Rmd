---
title: "Functions B"
tutorial:
  id: "functions-b"
output:
  learnr::tutorial:
      progressive: true
      allow_skip: true
runtime: shiny_prerendered
description: "Chapter 3 Tutorial Part B"
---


```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(skimr)
library(primer.data)

# Key Data

no_NA_sampler <- function(var, tbl, n){
  tbl %>% 
    drop_na() %>%
    sample_n(n) %>% 
    pull({{var}})
}

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 

```

## Information
###

```{r information}
quiz(caption = "",
  question_text(
    "Name:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL),
  question_text(
    "Email:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL))
```


## no_NA_sampler()
###

In this section, we will make a custom function called `no_NA_sampler()`.

### Exercise 1

Recall the `nhanes` dataset. Use `$` to extract the `weight` column. 

```{r no-1, exercise = TRUE}

```


```{r no-1-hint-1, eval = FALSE}
nhanes$...
```

```{r no-1-hint-2, eval = FALSE}
nhanes$weight
```

### Exercise 2

Let's create a function that allows us to sample `weight` from a tibble that contains no NA values for any of its variables.

```{r no-2, exercise = TRUE}

```


```{r no-2-hint-1, eval = FALSE}
nhanes$...
```

```{r no-2-hint-2, eval = FALSE}
nhanes$weight
```

### Exercise 3

Start a pipe with `nhanes`. Use `drop_na()` to get rid of any NA values.

```{r no-3, exercise = TRUE}

```


```{r no-3-hint, eval = FALSE}
... %>% 
  drop_na()
```

### Exercise 4

Copy/paste your code from above. Pipe the result to `sample_n()` with setting the `size` argument to 3. 

```{r no-4, exercise = TRUE}

```


```{r no-4-hint, eval = FALSE}
... %>% 
  sample_n(size = ...)
```

### Exercise 5 

Copy/paste your code from above. Pipe the result to `pull()` with the argument `weight`. 

```{r no-5, exercise = TRUE}

```


```{r no-5-hint, eval = FALSE}
... %>% 
  pull(...)
```

### Exercise 6

Let's first make a function `no_NA_sampler()` that doesn't do anything.

```{r no-6, exercise = TRUE, error = TRUE}

```


```{r no-6-hint, eval = FALSE}
no_NA_sampler() <- function(){
  
}
```

### Exercise 7

Copy/paste your code from above. On the line below, call `no_NA_sampler()` to see that no output is returned.

```{r no-7, exercise = TRUE, error = TRUE}

```


```{r no-7-hint-1, eval = FALSE}
no_NA_sampler() <- function(){
  
}

no_NA_sampler()
```

### Exercise 8

Copy/paste your code from *Exercise 5* and place it inside the body `{ }` of `no_NA_sampler()`. 

```{r no-8, exercise = TRUE}

```


```{r no-8-hint-1, eval = FALSE}
no_NA_sampler <- function(){
  ...
}

no_NA_sampler()
```

### Exercise 9

Now adjust the code so we can pull any sample, not just 3! To do so, add the `n` argument inside `function()`. Also replace the 3 within `sample_n()` with `n`. 

```{r no-9, exercise = TRUE}

```


```{r no-9-hint-1, eval = FALSE}
no_NA_sampler <- function(...){
  nhanes %>% 
    drop_na() %>%
    sample_n(size = ...) %>% 
    pull(weight)
}
```

### Exercise 10

Now call `no_NA_sampler()`. Notice that you receive an error message.

```{r no-10-setup}
no_NA_sampler <- function(n){
  nhanes %>% 
    drop_na() %>%
    sample_n(size = n) %>% 
    pull(weight)
}
```

```{r no-10, exercise = TRUE}

```

### Exercise 11

We need to pass an argument for `n` when we call `no_NA_sampler()`. Call `no_NA_sampler()` setting the `n` argument to 5.

```{r no-11-setup}
no_NA_sampler <- function(n){
  nhanes %>% 
    drop_na() %>%
    sample_n(size = n) %>% 
    pull(weight)
}
```

```{r no-11, exercise = TRUE}

```

Great. Now we can use `sample_n()` with any size we want!


### Exercise 12

Copy/paste your code from above. Let's adjust our function to allow sampling from any variable. To do so, add the `var` argument inside `function()`. Also replace `weight` within `pull()` with `{{var}}`. 

```{r no-12, exercise = TRUE}

```


```{r no-12-hint-1, eval = FALSE}
no_NA_sampler <- function(n, ...){
nhanes %>% 
    drop_na() %>%
    sample_n(size = n) %>% 
    pull(...)
}
```

### Exercise 13

Now call `no_NA_sampler()`. Recall that we will receive an error message if we don't specify the `n` and `var` arguments. Call `no_NA_sampler()` setting the `n` argument to 5 and `var` to `height`.


```{r no-13-setup}
no_NA_sampler <- function(n, var){
nhanes %>% 
    drop_na() %>%
    sample_n(size = n) %>% 
    pull({{var}})
}
```

```{r no-13, exercise = TRUE}

```


```{r no-13-hint-1, eval = FALSE}
no_NA_sampler(n = ..., var = ...)
```

### Exercise 14

Let's adjust our function one last time to now allow sampling from any tibble. The code so far has been provided for you. Add the `tbl` argument inside `function()`. Also replace `nhanes` with `tbl`. 

```{r no-14, exercise = TRUE}
no_NA_sampler <- function(n, var){
nhanes %>% 
    drop_na() %>%
    sample_n(size = n) %>% 
    pull({{var}})
}
```


```{r no-14-hint-1, eval = FALSE}
no_NA_sampler <- function(n, var, ...){
... %>% 
    drop_na() %>%
    sample_n(size = n) %>% 
    pull({{var}})
}
```

### Exercise 15

Great. Now call the `no_NA_sampler()` with the argument `n` set to 5. Also set `var` to `age` and set `tbl` to `cces`.

```{r no-15-setup}
no_NA_sampler <- function(n, var, tbl){
  tbl %>% 
    drop_na() %>%
    sample_n(size = n) %>% 
    pull({{var}})
}
```

```{r no-15, exercise = TRUE}

```

```{r no-15-hint, eval = FALSE}
no_NA_sampler(n = ..., var = ..., tbl = ...)
```

Great work. The resulting function we now have allows us to sample values from any tibble that does not have NA values. We can also use any sample size, or variable from the tibble of interest!



## Prediction Game
###

Before you complete this section, make sure to read the [Prediction Game](https://ppbds.github.io/primer/functions.html#prediction-game) section of the primer!

In this section, we will build a function called `prediction_game()` that allows for any guesses, tibble, and variable as an argument.


### Exercise 1

Let's start by using `glimpse()` to look at `kenya`.

```{r pg-1, exercise = TRUE}

```

### Exercise 2

Now create a function named `prediction_game()` `that does nothing. 

```{r pg-2, exercise = TRUE}

```

```{r pg-2-hint-1, eval = FALSE}
Use function() and { }
```

```{r pg-2-hint-2, eval = FALSE}
prediction_game <- function() { 
  }
```

### Exercise 3

Copy/paste your code from above. Have your function always `return()` "I win!". On the line below, call your function.

```{r pg-3, exercise = TRUE}

```

```{r pg-3-hint-1, eval = FALSE}
prediction_game<- function() { 
  ...
}

prediction_game()
```

```{r pg-3-hint-2, eval = FALSE}
prediction_game<- function() { 
  return(...)
}

prediction_game()
```

### Exercise 4

Now add the argument `guesses` inside `function()`. Then, call your function. Notice that doesn't change anything yet. 

```{r pg-4, exercise = TRUE}

```

```{r pg-4-hint, eval = FALSE}
prediction_game<- function(...) { 
  return("I win!")
}

prediction_game()
```

### Exercise 5

Now use `stopifnot()` to make our function stop if we do not select two guesses. Inside `stopifnot()`, use the argument `all(is_double())`. Within `is_double()` use the argument `guesses`. Then, call your function.

```{r pg-5, exercise = TRUE}

```

```{r pg-5-hint, eval = FALSE}
prediction_game<- function(guesses) { 
  return("I win")
  stopifnot(all(is_double(...)))
  
}

prediction_game()
```

### Exercise 6

Let's also use `stopifnot()` to make our function stop if the guesses are not in the format of c(guess 1, guess 2). Inside `stopifnot()`, use the argument `length()` with the argument `guesses`. Set the `length()` statement equal to 2. Then, call your function.

```{r pg-6, exercise = TRUE}

```

```{r pg-6-hint-1, eval = FALSE}
Use the equal operator outside of length(guesses). Recall to use == rather than = . 
   
```

```{r pg-6-hint-2, eval = FALSE}
prediction_game<- function(guesses) { 
  return("I win")
  stopifnot(all(is_double(guesses)))
  stopifnot(length(...) == ...)
   

}

prediction_game()
```

### Exercise 7

Great. Now tell the function that the "guess" inputted first is `guess_1` and the second input is `guess_2`. 

Assign `guesses[1]` to `guess_1`. Also, assign `guesses[2]` to `guess_2`. Then, call your function.

```{r pg-7, exercise = TRUE}

```

```{r pg-7-hint, eval = FALSE}
prediction_game<- function(guesses) { 
  return("I win")
  stopifnot(all(is_double(guesses)))
  stopifnot(length(...) == ...)
  
  guess_1 <- guesses[...]
  guess_2 <- guesses[...]

}

prediction_game()

```

### Exercise 8

Now add the `tbl` and `var` arguments within `function()`. Also, use `no_NA_sampler()`. The first argument to `no_NA_sampler()` should be `tbl`. The second argument should be `{{var}}`. Then, set `n` to 1.  Assign your work to an object named `sampled_value`. Then, call your function.

```{r pg-8, exercise = TRUE}

```

```{r pg-8-hint, eval = FALSE}
prediction_game<- function(guesses, ..., ...) { 
  return("I win")
  stopifnot(all(is_double(guesses)))
  stopifnot(length(guesses) == 2)

  guess_1 <- guesses[1]
  guess_2 <- guesses[2]
  
  sampled_value <- no_NA_sampler(..., ..., ...)
  
}

prediction_game()
```

### Exercise 9

Let's calculate the error for each guess. Use `abs()` and subtract `sampled_value` from `guess_1`. Save your work to an object named `guess1_error`. Then, call your function.

```{r pg-9, exercise = TRUE}

```

```{r pg-9-hint, eval = FALSE}
prediction_game<- function(guesses, tbl, var) { 
  return("I win")
  stopifnot(all(is_double(guesses)))
  stopifnot(length(guesses) == 2)

  guess_1 <- guesses[1]
  guess_2 <- guesses[2]

  sampled_value <- no_NA_sampler(tbl, {{var}}, n = 1)
  guess1_error <- abs(...- ...)
  
}

prediction_game()
```

### Exercise 10

Let's calculate the error for the second guess. Use `abs()` and subtract `sampled_value` from `guess_2`.Save your work to an object named `guess2_error`. Then, call your function.

```{r pg-10, exercise = TRUE}

```

```{r pg-10-hint, eval = FALSE}
prediction_game<- function(guesses, tbl, var) { 
  return("I win")
  stopifnot(all(is_double(guesses)))
  stopifnot(length(guesses) == 2)
  
  guess_1 <- guesses[1]
  guess_2 <- guesses[2]
  
  sampled_value <- no_NA_sampler(tbl, {{var}}, n = 1)

  guess1_error <- abs(guess_1- sampled_value)
  guess2_error <- abs(...- ...)

}

prediction_game()
```

### Exercise 11

Let's now have our code tell which is closer to the sampled value. First, remove `return("I win")` from your code. On the line below, call your function. Then, call your function.

```{r pg-11, exercise = TRUE, error = TRUE}

```

```{r pg-11-hint, eval = FALSE}
prediction_game<- function(guesses, tbl, var) { 
  stopifnot(all(is_double(guesses)))
  stopifnot(length(guesses) == 2)
  
  guess_1 <- guesses[1]
  guess_2 <- guesses[2]
  
  sampled_value <- no_NA_sampler(tbl, {{var}}, n = 1)

  guess1_error <- abs(guess_1- sampled_value)
  guess2_error <- abs(guess_2- sampled_value)

  
}

prediction_game()
```

Oh no! We get the error message *argument "guesses" is missing, with no default*. That is because we need to set the argument `guesses` to a value within `prediction_game()`. Note that we also need to specify the `tbl` and `var` arguments too. 


### Exercise 12

Let's add in the required arguments for `guesses`, `tbl`, and `var`. Copy and paste your code from above. When you call your function, set the argument `guesses` to `c(150, 700)`. Also set `tbl` to `kenya` and `var` to `rv13`.

```{r pg-13, exercise = TRUE, error = TRUE}

```

```{r pg-13-hint, eval = FALSE}
prediction_game<- function(guesses, tbl, var) { 
  stopifnot(all(is_double(guesses)))
  stopifnot(length(guesses) == 2)
  
  guess_1 <- guesses[1]
  guess_2 <- guesses[2]
  
  sampled_value <- no_NA_sampler(tbl, {{var}}, n = 1)

  guess1_error <- abs(guess_1- sampled_value)
  guess2_error <- abs(guess_2- sampled_value)

  if(guess1_error < guess2_error) { 
    return(paste("Guess", guess_1, "wins!"))
  }

}
prediction_game(guesses = ..., tbl = ..., var = ...)
```

<!-- BG: I get "object not found" whenever I try to use kenya and the rv13 variable -->

### Exercise 13

How do we know which guess was better? Let's have our function print out a message.

Use `if()` with the argument `guess1_error` less than `guess2_error`. Then use `{ }`. Within `{ }`, use `return()` with the argument `paste()`. The first argument to `paste()` should be "Guess". The second argument should be `guess_1`. The third argument should be "wins!".

```{r pg-12, exercise = TRUE}

```

```{r pg-12-hint, eval = FALSE}
prediction_game<- function(guesses, tbl, var) { 
  stopifnot(all(is_double(guesses)))
  stopifnot(length(guesses) == 2)
  
  guess_1 <- guesses[1]
  guess_2 <- guesses[2]
  
  sampled_value <- no_NA_sampler(tbl, {{var}}, n = 1)

  guess1_error <- abs(guess_1- sampled_value)
  guess2_error <- abs(guess_2- sampled_value)

  if( ... < ...) { 
    return(paste(..., ..., ...))
    
  }

}
prediction_game(guesses = c(150, 700), tbl = kenya, var = rv13)
```

### Exercise 14

Let's repeat the same code, but now for `guess_2`. When you call your function, you should get a message that reveals which guess wins.

```{r pg-14, exercise = TRUE}

```

```{r pg-14-hint, eval = FALSE}
prediction_game<- function(guesses, tbl, var) { 
  stopifnot(all(is_double(guesses)))
  stopifnot(length(guesses) == 2)
  
  guess_1 <- guesses[1]
  guess_2 <- guesses[2]
  
  sampled_value <- no_NA_sampler(tbl, {{var}}, n = 1)

  guess1_error <- abs(guess_1- sampled_value)
  guess2_error <- abs(guess_2- sampled_value)

  if(guess1_error < guess2_error) { 
    return(paste("Guess", guess_1, "wins!"))
  }
  
 if( ... < ...) { 
    return(paste(..., ..., ...))
 }
  
}

prediction_game(guesses = c(150, 700), tbl = kenya, var = rv13)
```

### Exercise 15

Copy/paste your code from above. Use `replicate()` to run our game five times. The first argument to `replicate()` should be 5. The second argument should be `prediction_game(guesses = c(150, 700), tbl = kenya, var = rv13)`.

```{r pg-15, exercise = TRUE}

```

```{r pg-15-hint, eval = FALSE}
prediction_game<- function(guesses, tbl, var) { 
  stopifnot(all(is_double(guesses)))
  stopifnot(length(guesses) == 2)
  
  guess_1 <- guesses[1]
  guess_2 <- guesses[2]
  
  sampled_value <- no_NA_sampler(tbl, {{var}}, n = 1)

  guess1_error <- abs(guess_1- sampled_value)
  guess2_error <- abs(guess_2- sampled_value)

  if( guess1_error < guess2_error) { 
    return(paste("Guess", guess_1, "wins!"))
  }
    
  if(guess2_error < guess1_error) { 
    return(paste("Guess", guess_2, "wins!"))
  }

}

replicate(..., prediction_game(guesses = c(150, 700), tbl = kenya, var = rv13))
```

