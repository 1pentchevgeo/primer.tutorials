---
title: "Functions B"
tutorial:
  id: "functions-b"
output:
  learnr::tutorial:
      progressive: true
      allow_skip: true
runtime: shiny_prerendered
description: "Chapter 3 Tutorial Part B"
---


```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(gapminder)
library(skimr)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 

```

## Information
###

```{r information}
quiz(caption = "",
  question_text(
    "Name:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL),
  question_text(
    "Email:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL))
```


## no_NA_sampler()
###


### Exercise 1

Recall the `nhanes` dataset. Use `$` to extract the `weight` column. 

```{r no-1, exercise = TRUE}

```


```{r no-1-hint-1, eval = FALSE}

```

### Exercise 2

Let's write a function that allows us to sample `weight` from individuals who have no NA's for any variables.

Start your code with`nhanes`. Use `drop_na()` to get rid of any NA values.

```{r no-2, exercise = TRUE}

```


```{r no-2-hint-1, eval = FALSE}

```

### Exercise 3

Now use `sample_n()` with the argument 10. Then, `pull()` `height`. 

```{r no-3, exercise = TRUE}

```


```{r no-3-hint-1, eval = FALSE}

```

### Exercise 4

Great, we have code that does what we want. To turn this into a function, we just need to copy/paste our code above within the body `{ }` of our `function()`. Assign your work to an object named `no_NA_sampler`, then call your function.

```{r no-4, exercise = TRUE}

```


```{r no-4-hint-1, eval = FALSE}
no_NA_sampler <- function(){
  ...
}

no_NA_sampler()
```

### Exercise 5

Let's adjust our code so we pull any sample, not just 10! To do so, place an `n` inside `function()`. Also replace 10 with `n` inside `sample_n()`. 

```{r no-5, exercise = TRUE}

```


```{r no-5-hint-1, eval = FALSE}
no_NA_sampler <- function(...){
  nhanes %>% 
    drop_na() %>%
    sample_n(...) %>% 
    pull(weight)
}
no_NA_sampler()
```

### Exercise 6

Put your function in action! Use the function `no_NA_sampler()` and set `n` to 20. 

```{r no-6-setup}
no_NA_sampler <- function(n){
  nhanes %>% 
    drop_na() %>%
    sample_n(n) %>% 
    pull(weight)
}
```

```{r no-6, exercise = TRUE}

```

### Exercise 7

Let's adjust our function one more time to allow sampling from a different variable than `weight` or from a different tibble than `nhanes`.

Copy and paste your code from above. First, add the argument `tbl` within `function()`. Also replace `nhanes` with `tbl`. 

```{r no-7, exercise = TRUE}

```


```{r no-7-hint-1, eval = FALSE}
no_NA_sampler <- function(..., n){
  ... %>% 
    drop_na() %>%
    sample_n(n) %>% 
    pull(weight)
}
no_NA_sampler()
```

### Exercise 8

Great. Now add the argument `var` inside `function()`. Also replace `weight` with the argument `{{var}}`

```{r no-8, exercise = TRUE}

```


```{r no-8-hint-1, eval = FALSE}
no_NA_sampler <- function(..., tbl, n){
  tbl %>% 
    drop_na() %>%
    sample_n(n) %>% 
    pull(...)
}
no_NA_sampler()
```

### Exercise 9

Put your function in action! Use the function `no_NA_sampler()`. The first argument to `no_NA_sampler()` should be `cces`. The second argument should be `age`. Then, set `n` to 10. 

```{r no-9-setup}
no_NA_sampler <- function(var, tbl, n){
  tbl %>% 
    drop_na() %>%
    sample_n(n) %>% 
    pull({{var}})
}

```

```{r no-9, exercise = TRUE}

```


## Prediction Game
###

Before you complete this section, make sure to read the [Prediction Game](https://ppbds.github.io/primer/functions.html#prediction-game) section of the primer!

in this section, we will build a function called `prediction_game()` that allows for any guesses, tibble, and variable as an argument.

```{r}
no_NA_sampler <- function(var, tbl, n){
  tbl %>% 
    drop_na() %>%
    sample_n(n) %>% 
    pull({{var}})
}

prediction_game <- function(guesses, tbl, var){
  stopifnot(all(is_double(guesses)))
  stopifnot(length(guesses) == 2)
  
  your_guess <- guesses[1]
  my_guess <- guesses[2]
  
  sampled_value <- no_NA_sampler(tbl, {{var}}, n = 1) 
  
  your_error <- abs(your_guess - sampled_value)
  my_error <- abs(my_guess - sampled_value)

  if(your_error < my_error){ 
    return(paste("Guess", your_guess, "wins!"))
  }
  
  
  if(your_error > my_error){ 
    return(paste("Guess", my_guess, "wins!"))
  }
  
  if(your_error == my_error){ 
    return("A tie!")
  }

}

```


### Exercise 1

Let's begin by using `glimpse()` to look at `kenya`.

```{r pg-1, exercise = TRUE}

```

```{r pg-1-hint, eval = FALSE}

```

### Exercise 2

Now create a function named `prediciton_game` `that does nothing. 

```{r pg-2, exercise = TRUE}

```

```{r pg-2-hint-1, eval = FALSE}
Use function() and { }
```

```{r pg-2-hint-2, eval = FALSE}
prediction_game<- function() { 
  }
```

### Exercise 3

Now have your function always `return()` "I win!"

```{r pg-3, exercise = TRUE}

```

```{r pg-3-hint-1, eval = FALSE}
prediction_game<- function() { 
  ...
  }
```

```{r pg-3-hint-2, eval = FALSE}
prediction_game<- function() { 
  return(...)
  }
```

### Exercise 4

Now add the argument `guesses` inside `function()`. 

```{r pg-4-setup}
A_guess <- 400
```

```{r pg-4, exercise = TRUE}

```

```{r pg-4-hint, eval = FALSE}

```

Notice that doesn't change anything yet.

### Exercise 5

Copy and paste your code. 

```{r pg-5, exercise = TRUE}

```

```{r pg-5-hint, eval = FALSE}

```

### Exercise 6

The winner is the person whose guess is closest to the random value selected (least error). Let's now write to code to print out if A wins. Use `if()` with the argument A_error less than B_error. Then, use `cat()` with the argument "A wins!".

```{r pg-6-setup}
A_guess <- 400
B_guess <- 200
A_error <- abs(A_guess - sampled_value)
B_error <- abs(B_guess - sampled_value)
```

```{r pg-6, exercise = TRUE}

```

```{r pg-6-hint, eval = FALSE}
if(... < ...) cat(...)
```

### Exercise 7

Let's now write code for B winning. Use `if()` with the argument B_error less than A_error. Then, use `cat()` with the argument "B wins!".

```{r pg-7-setup}
A_guess <- 400
B_guess <- 200
A_error <- abs(A_guess - sampled_value)
B_error <- abs(B_guess - sampled_value)
```

```{r pg-7, exercise = TRUE}

```

```{r pg-7-hint, eval = FALSE}
if(... < ...) cat(...)
```

### Exercise 8

The code you have created so far is given in the code chunk below. Use `function()` and `{ }` to turn the game into a function. Name your function `prediction_game`.

```{r pg-8-setup}
A_guess <- 400
B_guess <- 200
A_error <- abs(A_guess - sampled_value)
B_error <- abs(B_guess - sampled_value)
```

```{r pg-8, exercise = TRUE}
A_guess <- 500
B_guess <- 600
sampled_value <- no_NA_sampler(kenya, rv13, n = 1) 
A_error <- abs(A_guess - sampled_value)
B_error <- abs(B_guess - sampled_value)
if(A_error < B_error) cat("A wins!")
if(B_error > A_error) cat("B wins!")
```

```{r pg-8-hint, eval = FALSE}
prediction_game <- function(){
  ...
}
```

### Exercise 9

By creating a function, we can now easily run the game multiple times! Use `replicate()` to run the game 4 times. 

```{r pg-9-setup}
A_guess <- 400
B_guess <- 200
A_error <- abs(A_guess - sampled_value)
B_error <- abs(B_guess - sampled_value)

function() { 
A_guess <- 500
B_guess <- 600
sampled_value <- no_NA_sampler(kenya, rv13, n = 1) 
A_error <- abs(A_guess - sampled_value)
B_error <- abs(B_guess - sampled_value)
if(A_error < B_error) cat("A wins!")
if(B_error > A_error) cat("B wins!")
}
```

```{r pg-9, exercise = TRUE}

```

```{r pg-9-hint, eval = FALSE}
The first argument should be the number of times you want to run the function.
The second argument should be the function.
```

