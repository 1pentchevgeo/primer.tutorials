---
title: 'Probability: Permutation Tests'
author: Yuhan Wu
tutorial:
  id: probability-permutation-tests
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: Explain what a permutation test is and give examples of its use.
---

```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(primer.data)
knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 
```

```{r copy-code-chunk, child = "../../child_documents/copy_button.Rmd"}
```

```{r info-section, child = "../../child_documents/info_section.Rmd"}
```

<!-- Reread Chapter 4. Create a nice plot which shows the result of a permutation test, and then guide the student to doing it. Use this for background: https://www.youtube.com/watch?v=GmvpsJHGCxQ 
https://www.youtube.com/watch?v=rJ3AZCQuiLw
-->

## Permutation tests

###

We generally use parametric tests, which required the sample that were used in the test to have approximate normality, no outliers, and a large amount of data; however, sometimes it is difficult to meet the above prerequisites, then it is necessary to use the non-parametric test, which doesn't require any assumptions about the population of the data, but sometimes the non-parametric test cannot handle some cases with a small number of samples. In this case, you can use the *permutation test*.

*Permutation test* is a computationally intensive method proposed by Fisher for statistical inference using random arrangement of sample data (the core idea of permutation test, hence the name Permutation test). Because of its freedom of population distribution, it is especially suitable for small sample data with unknown population distribution, and some hypothesis testing situations that are difficult to use by conventional methods.

Let's construct an small example to show the idea of an *Permutation test*.

### 

```{r}
A <- c(17,22,24,25,29)
B <- c(15,18,21) 
C <- c(15,16,18,20,25,14,19,23)
mn_d = mean(A) - mean(B)
A_2 <- sample(C, size = 5, replace = FALSE)
B_2 <- subset(C, ! C %in% A_2)
mn_d2 <- mean(A_2) - mean(B_2)
mn_d
mn_d2

# expand_grid(a = A, b = B, c = C) %>%
#   mutate(mean_d = mean(a) - mean(c)) %>%
#   mutate(a_2 = map_dbl(a, ~list(sample(.,size = 5, replace = FALSE)))) %>%
#   mutate(b_2 = map_dblt(a_2, ~list(subset(C, ! C %in% A_2))))
```


### Exercise 1

Suppose we design to verify that the height of Bamboo will increase significantly after adding certain auxin. Group A is the height of bamboos after adding a certain auxin; B is the the height of bamboos without adding auxin (all assumed values).

Group A (12 data in meters): 6, 6, 8, 9, 9, 10, 11, 14, 17, 20, 21, 23  
Group B (9 data in meters):  6, 8, 10, 11, 13, 15, 16, 17, 19

Use `tibble()` create two variables,the first variable `A` and set it equal to `list()` which include the 12 values above wrap around by `c()`. She second variable B and set it equal to `list()` which include the 9 values above wrap around by `c()`. Your result should only have 1 row.
```{r permutation-tests-1, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r permutation-tests-1-hint, eval = FALSE}
tibble(A = list(c(6, 6, 8, 9, 9, 10, 11, 14, 17, 20, 21, 23)),
       B = list(c(6, 8, 10, 11, 13, 15, 16, 17, 19)))
```

###
Our null hypothesis is: the added auxin will not promote the height growth of bamboo. In this test, if the null hypothesis is true, then the distribution of the data in group A and the distribution of data in group B are the same, that is, subject to the same distribution.

### Exercise 2

Next, construct the test statistic - the difference between the mean value of the height of bamboos in group A and the mean value of the height of bamboos in group B. 

Use `summarise()`
```{r permutation-tests-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r permutation-tests-2-hint, eval = FALSE}

```

###

### Exercise 3


```{r permutation-tests-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r permutation-tests-3-hint, eval = FALSE}

```

###

### Exercise 4


```{r permutation-tests-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r permutation-tests-4-hint, eval = FALSE}

```

###

### Exercise 5


```{r permutation-tests-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r permutation-tests-5-hint, eval = FALSE}

```

###

### Exercise 6


```{r permutation-tests-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r permutation-tests-6-hint, eval = FALSE}

```

###


```{r download-answers, child = "../../child_documents/download_answers.Rmd"}
```
