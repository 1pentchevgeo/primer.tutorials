---
title: "Visualization D"
tutorial:
  id: "visualization-d"
output:
  learnr::tutorial:
      progressive: true
      allow_skip: true
runtime: shiny_prerendered
description: "Chapter 1 Tutorial Part D"
---

<!-- Things to Do -->

<!-- Make a plot of one of them that shows this somehow? Plot histogram then put 6 vertical lines, two each for mean +/- 2 sd, median +/- 2 mad, 95% quantile. The mean + 2 x the sd should be about the 97.5th percentile. Won't be exact! But about. The median + 2 x the mad should be about the 97.5th percentile. Won't be exact! But about. Same with subtraction. -->


```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(primer.data)
library(ggthemes)
library(skimr)


knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 

# Key Data

set.seed(9)
results <- rnorm(10000)

# For example plots

nhanes_a <- nhanes %>% 
  drop_na(pulse) %>% 
  filter(age >= 18) 

```

## Information
###

```{r information}
quiz(caption = "",
  question_text(
    "Name:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL),
  question_text(
    "Email:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL))
```

## Summary Statistics 
###

### Exercise 1 

`skim()` the data set `nhanes`. 

```{r ss-1, exercise = TRUE}

```

```{r ss-1-hint-1, eval = FALSE}
c(min(...), median(...), max(...))
```

###

Notice that pulse has 30 missing values. 

### Exercise 2

Filter `nhanes` so that it contains only rows whose `age` column has a value greater than 18. Save the result to a new object called `nhanes_a`

```{r ss-2, exercise = TRUE}

```

```{r ss-2-hint-1, eval = FALSE}
nhanes_a <- nhanes %>% 
  filter(nhanes >= 18)
```

### Exercise 3

Copy/paste your code. Use `drop_na()` to drop all rows containing missing values in the `pulse` column.

```{r ss-3, exercise = TRUE}

```

```{r ss-3-hint-1, eval = FALSE}
 ... %>% 
  drop_na(pulse)
```

### Exercise 4

Use `c()` to make a vector that contains the `min()`, `median()`, and `max()` of the data in `pulse`. Remember that we use the dollar sign `$` to pull out a column of a tibble as a vector, which is what `min()`, `median()`, and `max()` take as arguments.

```{r ss-4, exercise = TRUE}

```

```{r ss-4-hint-1, eval = FALSE}
c(min(...), median(...), max(...))
```

```{r ss-3-hint-2, eval = FALSE}
c(min(nhanes$pulse), median(nhanes$pulse), max(nhanes$puslse))
```

### 

When generating summary statistics with `c()`, do not start a pipe from the data set. The results are not good. 

### Exercise 5

Let's find the 0th, 50th, and 100th percentiles using `quantile()`. Set the first argument in `quantile()` to be the vector you want to evaluate, `nhanes$pulse`. The second argument should set `probs` equal to a vector of the probabilities in decimal form, 0, .5, and 1.

```{r ss-5, exercise = TRUE}

```

```{r ss-5-hint, eval = FALSE}
quantile(..., probs = c(..., ..., ...))
```

###

Notice that we get the same values as our min, median, and max, respectively. What does this mean:  
- 0% of the data falls below -3.818 (the min) \
- The 50th percentile splits the data into two separate/equal parts (the median) \
- 100% of the data falls below 3.793 (the max) \

### Exercise 6

Use `quantile()` to calculate the 2.5th and 97.5th percentiles of the data in the `pulse` column. Remember that the probabilities should be in decimal form. 

```{r ss-6, exercise = TRUE}

```

```{r ss-6-hint, eval = FALSE}
quantile(..., probs = c(.025, .975))
```

###

These two percentiles form the 95% interval, within which 95% of the data are contained. In contexts of probability, this interval is often called the 95% confidence interval. The green lines on the plot below show the 95% interval. 

```{r make-pulse-95}
pulse_95 <- nhanes_a %>% 
  ggplot(aes(x = pulse)) +
  geom_histogram(bins = 40, alpha = 0.7) +
  geom_vline(xintercept = 54, color = "green") +
  geom_vline(xintercept = 98, color = "green") +
  ggthemes::theme_clean() +
  labs(title = "Pulse of American Adults", 
       x = "Pulse", 
       y = "Count")

pulse_95
```


### Exercise 6

Make a vector that contains the `mean()`, `median()`, `sd()` and `mad()` of the column `pulse`.

```{r ss-7, exercise = TRUE}

```

```{r ss-7-hint, eval = FALSE}
 c(mean(...), median(...), sd(...), mad(...))
```

### 

The mean and median are both different ways to measure a central value of data. Their values are similar, but not exactly the same. In the plot below, the blue line represents the mean, and the red line represents the median. Both values are very close to the mode, the pulse value which occurs most often. 

```{r make-pulse-centrals}
pulse_centrals <- nhanes_a %>% 
  ggplot(aes(x = pulse)) +
  geom_histogram(bins = 40, alpha = 0.7) +
  geom_vline(xintercept = 74, color = "red") +
  geom_vline(xintercept = 74.57, color = "blue") +
  geom_vline(xintercept = 54, color = "green") +
  geom_vline(xintercept = 98, color = "green") +
  theme_clean() +
  labs(title = "Pulse of American Adults", 
       x = "Pulse", 
       y = "Count")

pulse_centrals
```



### Exercise 7

The standard deviation (sd) and median average deviation (mad) are both different ways to measure how spread out the data are from a central value. The `sd()` uses the mean as its central value, and the `mad()` uses the median. As these values increase, one should expect to see less data clustered around the central value and more at increasingly far extremes. Both values can be used together with their corresponding central values to approximate the 95% interval with the same method. 

##

Let's first approximate the 95% interval using the `sd()`. Make a vector contains two items: two times the value of `sd()` subtracted from  the `mean()` and two times the value of `sd()` added to the `mean()`. 

```{r ss7, exercise = TRUE}

```

```{r ss7-hint-1, eval = FALSE}
Inside mean() and sd() use the argument nhanes$pulse.
Use + to add and * to multiply.
```

```{r ss7-hint-2, eval = FALSE}
c(mean(...) - 2 * sd(...), 
  mean(...)  + 2 * sd(...))
```

###

The two outer lines in blue show the approximation of the 95% confidence interval by the standard deviation. Observe how close the approximation for the 97.5th percentile is to the one estimated by the standard deviation. 

```{r make-sd-int}
nhanes_sd_ints <- nhanes_a %>% 
  ggplot(aes(x = pulse)) +
  geom_histogram(bins = 40, alpha = 0.7) +
  geom_vline(xintercept = 74, color = "red") +
  geom_vline(xintercept = 74.57, color = "blue") +
  geom_vline(xintercept = 51.44, color = "blue") +
  geom_vline(xintercept = 97.7, color = "blue") +
  geom_vline(xintercept = 54, color = "green") +
  geom_vline(xintercept = 98, color = "green") +
  ggthemes::theme_clean() +
  labs(title = "Pulse of American Adults", 
       x = "Pulse", 
       y = "Count")

nhanes_sd_ints 
```

### Exercise 8 

Let's now approximate the 95% interval using the `mad()`. Make a vector contains two items: two times the value of `mad()` subtracted from  the `mean()` and two times the value of `mad()` added to the `median()`. 

```{r ss8, exercise = TRUE}

```

```{r ss8-hint-1, eval = FALSE}
Inside median() and mad() use the argument nhanes$pulse.
Use + to add and * to multiply.
```

```{r ss8-hint-2, eval = FALSE}
c(median(...) - 2 * mad(...), 
  median(...)  + 2 * mad(...))
```

###

The two outer lines in red show the approximation of the 95% confidence interval by the median average deviation. The standard deviation appears to be a slightly better estimate of the 2.5th percentile for this data. The estimates for the 97.5th percentile are so close that the lines overlap into one purple line. 

```{r}
nhanes_mad_ints <- nhanes_a %>% 
  ggplot(aes(x = pulse)) +
  geom_histogram(bins = 40, alpha = 0.7) +
  geom_vline(xintercept = 74, color = "red") +
  geom_vline(xintercept = 74.57, color = "blue") +
  geom_vline(xintercept = 50.28, color = "red") +
  geom_vline(xintercept = 97.72, color = "red", alpha = .5) +
  geom_vline(xintercept = 51.44, color = "blue") +
  geom_vline(xintercept = 97.7, color = "blue", alpha = .5) +
  geom_vline(xintercept = 54, color = "green") +
  geom_vline(xintercept = 98, color = "green") +
  ggthemes::theme_clean() +
  labs(title = "Pulse of American Adults", 
       x = "Pulse", 
       y = "Count")
```

## Submit

```{r context = "setup"}
submission_ui
```

```{r context = "server"}
submission_server()
```






