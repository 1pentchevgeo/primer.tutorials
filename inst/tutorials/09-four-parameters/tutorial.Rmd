---
title: "Four Parameters"
tutorial:
  id: "four-parameters"
output:
  learnr::tutorial:
      progressive: true
      allow_skip: true
runtime: shiny_prerendered
description: "Chapter 9 tutorial"
---


```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(primer.data)
library(rstanarm)
library(broom.mixed)

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 600,   # Extra time for model building
        tutorial.storage = "local") 

fit_1 <- stan_glm(formula = att_end ~ liberal + att_start,
                  data = trains,
                  refresh = 0,
                  seed = 42)

tidy <- fit_1 %>% 
  tidy() %>% 
  select(term, estimate)

intercept <- tidy$estimate[1]
liberal_true <- tidy$estimate[2]
att_start <- tidy$estimate[3]

liberal_false_intercept <- intercept
liberal_false_att_slope <- att_start

liberal_true_intercept <- intercept + liberal_true
liberal_true_att_slope <- att_start

```

## Information
###

```{r information}
quiz(caption = "",
  question_text(
    "Name:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL),
  question_text(
    "Email:",
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL))
```

## Wisdom
###

Consider the following plot.

```{r wisdom}
ggplot(trains, aes(x = att_start, y = att_end, color = liberal)) +
  geom_point() +
  labs(title = "Attitude End Compared with Attitude Start and Liberal",
       x = "Attitude at Start of Study",
       y = "Attitude at End of Study",
       color = "Liberal?")
```

The following plot shows a comparison of three variables in the `trains` dataset. Using **Wisdom**, write a paragraph about whether or not the variables `att_start` and `liberal` should be used to predict `att_end`. See *The Primer* for guidance.

```{r wisdom-1}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 6))
```

## Justice and Courage
###

Let's build a model. Our outcome variable will be `att_end` and we will have two explanatory variables: `liberal` and `att_start`. Here is the math we will be using:

$$y_i = \beta_0  + \beta_1 x_1 + \beta_2 x_2$$ 

where 
$y = att_end$, $x_1 = `att_start`$, and $x_2 = `liberal`$,

If liberal = FALSE:

$$y = \beta_0  + \beta_1 x_1 $$


If liberal = TRUE: 

$$y = (\beta_0  + \beta_2) + \beta_1 x_1 $$


### Exercise 1

Looking at the model above, which are the parameters? You do not need to figure out how to display the symbols in your answer, just write their names (i.e. "epsilon," "delta," etc. ).

```{r justice-1}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 6))
```

### Exercise 2

Great! Now write a sentence for each parameter that describes what it means.

```{r justice-2}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 6))
```


### Exercise 3

Let's implement the model using `stan_glm()`. The formula argument should be `att_end ~ liberal + att_start`. Set `data` to`trains`, and `refresh` to 0.  Also set the `seed` argument to 42. Assign your work to an object named `fit_1`.

```{r courage-3, exercise = TRUE}

```


```{r courage-3-hint, eval = FALSE}
fit_1 <- stan_glm(data = ...,
                  formula = ...,
                  refresh = ...,
                  seed = )
```

### Exercise 4

Use `print()` to look at our parameter values. Set the `detail` argument to FALSE.

```{r courage-4, exercise = TRUE}

```
 
```{r courage-4-hint, eval = FALSE}
print(..., detail = ...)
```

### Exercise 5

Look at the results above. Write two sentences, using your own words, that explains the meaning of `(Intercept)`.

```{r courage-5}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 3))
```

### Exercise 6

Write two sentences that explains the value of `att_start`.

```{r courage-6}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 3))
```


Let's create the following parallel slopes model. The model allows us to observe the differences in liberalTRUE and liberalFALSE in relation to attitude start and attitude end.


```{r}
ggplot(trains, aes(x = att_start, 
                   y = att_end, 
                   color = liberal)) +
  geom_point() +
  geom_abline(intercept = liberal_false_intercept,
              slope = liberal_false_att_slope, 
              color = "#F8766D", 
              size = 1) +
  geom_abline(intercept = liberal_true_intercept,
              slope = liberal_true_att_slope,
              color = "#00BFC4", 
              size = 1) +
  labs(title = "Parallel Slopes Model",
       subtitle = "Non-liberals start with higher att_start values",
       x = "Attitude at Start", 
       y = "Attitude at End", 
       color = "Liberal?") 

```

<!-- First step, we need to figure out... -->



## Temperance
###

<!-- look at ch. 8 examples of temperance questions- first question requires posterior_epred(), the second posterior_predict(), write a paragraph explaining what this distribution means -->

<!-- 1. What is the expected value for a liberal whose att_start is 3? -->

<!-- NOt doing multiple age plot here -->


## Submit

```{r context = "setup"}
submission_ui
```

```{r context = "server"}
submission_server()
```
