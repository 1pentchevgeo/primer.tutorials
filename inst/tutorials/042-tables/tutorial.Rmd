---
title: Tables
author: Arghayan Jeiyasarangkan
tutorial:
  id: tables
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: Learn to make cool tables
---

```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(primer.data)
library(knitr)
library(gt)
library(skimr)
knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 
```

```{r copy-code-chunk, child = "../../child_documents/copy_button.Rmd"}
```

```{r info-section, child = "../../child_documents/info_section.Rmd"}
```

<!-- Make a new tutorial which is "tables": https://ppbds.github.io/primer/tools.html#how-to-make-a-table. https://gt.rstudio.com/. First section should show how to make tables with knitr::kable(). Do it like distill package. Pull out table questions from distill and put them here. (You need to clean up distill, renumber exercises and so on. The Tables and Images section becomes just Images.) Make sure you have students do something to prove that they have followed the steps. Last section should be a brand new, start from scratch repo all the way to R pubs which makes a nice table. Take a look at RStudio and Friends tutorial. Interesting: -->




<!-- Pick another package (beyond kable and gt) which specializes in interactive tables. Create a Section which uses it. Maybe https://themockup.blog/posts/2020-05-13-reactable-tables-the-rest-of-the-owl/.  Done.-->

<!-- Add a gtsummary section. Inspiration: https://www.pipinghotdata.com/posts/2021-07-14-polished-summary-tables-in-r-with-gtsummary/ -->


## kable

### 

The **knitr** package "provides a general-purpose tool for dynamic report generation in R using [Literate Programming](https://en.wikipedia.org/wiki/Literate_programming) techniques."  `kable()` is a function in **knitr** for [making tables](https://bookdown.org/yihui/rmarkdown-cookbook/kable.html).

### Exercise 1

We will use the data in `mtcars` in this section. Run `glimpse()` on `mtcars` to learn about the variables.

```{r kable-1, exercise = TRUE}

```

```{r kable-1-hint-1, eval = FALSE}
glimpse(mtcars) 
```

### 

<!-- Drop some knowledge. -->

### Exercise 2

Pipe `mtcars` to `arrange()`, to sort the data by ascending `mpg`.


```{r kable-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r kable-2-hint-1, eval = FALSE}
mtcars %>% 
  arrange(mpg)
```

### 

Notice that the first column, the name of the cars, does not have a column name. This is because it is not technically a column, but a **row name**. This is not the case with most of the data sets we work with (only data frames, not tibbles support it). 



### Exercise 3

Let's add a table using the function `kable()`. It is part of the `knitr` package.  First, copy your code from exercise 2 and load the **knitr** package on line 1

```{r kable-3, exercise = TRUE}

```

```{r kable-3-hint-1, eval = FALSE}
library(knitr)
```

### Exercise 4

Continue the pipe with `kable()`. 


```{r kable-4, exercise = TRUE}

```

```{r kable-4-hint-1, eval = FALSE}
... %>% 
  kable()
```

### 

`kable` produces a compact and well-formatted tibble. 

### Exercise 5

Let's add a table using the function `paged_table()`. It is part of `rmarkdown`. 

### 

In the setup chunk, load the library `rmarkdown`. Save `index.Rmd`

### 

In the Terminal, run `grep library index.Rmd`. Copy and paste the result here.


```{r kable-5}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 3)
```

### 

This should return all the lines in which you load packages, including the most recent, `rmarkdown`. 

### 

### Exercise 6

Create a new code chunk named `table-3`.

### 

In that chunk run `paged_table(table)`. Knit the .Rmd. 

### 

In the Terminal, run `tail index.Rmd`. 

```{r kable-6}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 3)
```

### 

`paged_table` produces a table similar to the R Markdown table output. Its chief advantage is that it allows for the table to have pages and take up less space. 

### Exercise 7

The table you just cannot display all of its columns in one window and so has a navigation arrow for the columns. There are two reasons for this: first, default maximum of columns printed with `paged_tables` is 10; second, the window in which Distill renders the table is too small. 

### 

Within your `paged_table` function, add `options(cols.print = 12)` as the second argument. Knit the .Rmd. 

### 

In the Terminal, run `grep options index.Rmd`. Copy and paste the result below. 

```{r kable-7}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 3)
```

### 

This tibble is even worse. YThe navigation arrow is still present and you need a horizantal scroller on the bottom to see it. 

### Exercise 8

To increase the width of the window in which Distill renders the graph, we can add options the setup chunk. After the chunk name add a comma and then the code `layout = "l-body-outset"`. 

### 

In the Terminal run the command `grep "r " index.Rmd`. This should return a list of all your code chunk headers, including the most recent one. Copy and paste the result below.

```{r kable-8}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    rows = 3)
```

### 

Now you should have a table which displays all twelve columns in one window. 

### 

For an even wider window for rendering objects in Distill, use `layout = "l-page"`. The layout command can be used for any object that Distill renders, including plots. 

### 

The command `datatable()` in the package `DT` allows for a paged table with even more user interaction. It allows the user to sort the table by variables and to search through the table. Here is an image of `mtcars` using the `DT` package function:

```{r}
include_graphics("images/datatable.png")
```

### 

While kable allows the creation of tables, customization of tables is limited when using this package. Instead we can use a different package that better suits our needs.

<!-- AJ: Research KableExtra -->

## gt

### 

```{r}
include_graphics("images/Dragon-Ball-GT.jpeg")
```

It is time to learn about **gt**

###

Nope not Dragon Ball GT.

###

```{r}
include_graphics("images/Ford-GT.jpeg")
```

###

Not the Ford GT either. 

### 

The **[gt](https://gt.rstudio.com/)** we will learn about is even better than those other ones Using **gt** you will be able to create better tables. 

### Exercise 1

### 

Load the **[gt](https://gt.rstudio.com/)** library.

```{r gt-1, exercise = TRUE}

```

```{r gt-1-hint-1, eval = FALSE}
library(...)
```

### 


Thomas Mock's [blog](https://themockup.blog) is another resource that can be [used](https://themockup.blog/posts/2020-05-16-gt-a-grammer-of-tables/) to [explore](https://themockup.blog/posts/2020-09-04-10-table-rules-in-r/) this package. 


### Exercise 2

### 

Run `?gt` on the next line to get more information about the `gt( )` function. This will give you an idea of what you need to make best use of this function.

```{r gt-2, exercise = TRUE}

```

```{r gt-2-hint-1, eval = FALSE}
?gt
```

### 

Some other packages we can use to create tables are **gt**, **reactable**, **DT**, **formattable**, and **flextable**.

### 

Now let's make a table! the table we will make will end up looking like this:

```{r}
gt_obj1 <- trains %>%
  select(gender, income, att_end) %>%
  slice(1:5) %>% 
  gt() %>%
    tab_header(title = md("**Enos Data Observations**"), 
               subtitle = "Gender, Income, and End Attitude from the Trains Data") %>%
    cols_label(gender = "Gender",
               income = "Income", 
               att_end = "End Attitude") %>% 
    tab_source_note(md("Source: Ryan Enos, *Causal Effect of Intergroup 
                       Contact on Exclusionary Attitudes*")) %>%
    fmt_currency(columns = c(income), 
                 decimals = 0) 
gt_obj1
```

### 

The data set that will be used to make this table is the `trains` data set which can be found in **primer.data**.

### Exercise 3

Print the `trains` data set


```{r gt-3, exercise = TRUE}

```

```{r gt-3-hint-1, eval = FALSE}
trains
```

### 

This shows us the first 10 rows of the data set. At this point we do not know what any of the data means.

### Exercise 4

Look up the help page with `?trains`.

```{r gt-4, exercise = TRUE}

```

```{r gt-4-hint-1, eval = FALSE}
?trains
```

### 

`?trains` isn't the only way to get more information about a data set. Some other functions are `glimpse(trains)`,  `summary(trains)`, `skim(trains)`, and `View(trains)`. 

### Exercise 5

Start a pipe with the `trains` data set. `select()` the `gender`, `income`, and `att_end` columns.

```{r gt-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-5-hint-1, eval = FALSE}
... %>% 
  select(..., ..., ...)
```

### 

`trains` is a data set that shows individuals' attitudes toward immigration-related policies, both before and after an experiment which randomly exposed a treated group to Spanish-speakers on a Boston commuter train platform.

### Exercise 6

Add `slice()` to the pipe so that only the first 5 rows are displayed

```{r gt-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-6-hint-1, eval = FALSE}
... %>% 
  slice(...:...)
```

### 

### Exercise 7

Continue your pipe with `gt( )`.

```{r gt-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-7-hint-1, eval = FALSE}
... %>% 
  gt()
```

### 

Your output should look like this:

```{r}
trains %>% 
  select(gender, income, att_end) %>%
  slice(1:5) %>% 
  gt()
```

### 

We now have a functional table. Let's make it look like the table we are aiming to make.

A reminder on how that table looks:

```{r}
gt_obj1
```

### Exercise 8

You can add a title and subtitle to the table by using `tab_header()`. Add a title and subtitle to your table.
```{r gt-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-8-hint-1, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = "...",
             subtitle = "...")
```

### 

What you have at this point should look like this:
```{r}
trains %>%
    select(gender, income, att_end) %>%
slice(1:5) %>% 
    gt() %>%
    tab_header(title = "Enos Data Observations", 
               subtitle = "Gender, Income, and End Attitude from the Trains Data")
```

### 

Notice how the title is not bold like it is in the table we want to recreate.

### Exercise 9

By default, titles and other text can not be formatted. To format them, wrap the character string in a call to md().

```{r gt-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-9-hint-1, eval = FALSE}
the code to bold text using md() is adding `**` to both ends of the string
```

```{r gt-9-hint-2, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...")
```

### Exercise 10

Change the column names using cols_label()
```{r gt-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-10-hint-1, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...") %>% 
  cols_label(... = "...",
             ... = "...",
             ... = "...")
```

### Exercise 11

Add a caption/cite your source using tab_source_note()

```{r gt-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-11-hint-1, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...") %>% 
  cols_label(... = "...",
             ... = "...",
             ... = "...") %>% 
  tab_source_note("...")
```

### Exercise 12

Part of the caption should be italicized. This can be done by wrapping the character string in a call to md()

```{r gt-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-12-hint-1, eval = FALSE}
The code to italicize text in md() is adding "*" to both ends of the string
```

```{r gt-12-hint-2, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...") %>% 
  cols_label(... = "...",
             ... = "...",
             ... = "...") %>% 
  tab_source_note(md("..., *...*"))
```

### Exercise 13

Add dollar signs and commas to the income column using fmt_currency() (if you only want commas, you can use fmt_number()). Put income within c() to indicate that income is a currency, and assign a value of 0 to the decimals argument. Make sure that your table looks like the table we are aiming to make.

```{r gt-13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-13-hint-1, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...") %>% 
  cols_label(... = "...",
             ... = "...",
             ... = "...") %>% 
  tab_source_note(md("..., *...*")) %>% 
  fmt_currency(c(...), decimals = ...)
```

Remember, your final table should look like

```{r}
gt_obj1
```

## nhanes

### 

Let's make a new table using a different data set to make sure we understand how to effectively use `gt`

The table we will be making will look like this:

<!-- AJ: Make cooler! attention grabbing -->

```{r}
nhanes_tbl <- nhanes %>% 
  filter(survey == 2011, gender == "Female", age > 40, race == "Mexican") %>% 
  drop_na() %>%
  select(hh_income, age, sleep, general_health) %>% 
  arrange(age) %>% 
  arrange(hh_income) %>% 
  gt() %>%
  tab_header(title = md("**Relationship between Household Income, Sleep and General Health in Mexican Women who are over 40 years old**"),
             subtitle = "Those who make over 75,000 seem to have the best General Health") %>% 
  cols_label(hh_income = "Household Income",
             age = "Age",
             sleep = "Sleep (in hours)",
             general_health = "General Health") %>% 
  tab_source_note(md("*National Health and Nutrition Examination Survey, 2011*")) %>% 
  tab_footnote(footnote = "General Health is ranked on a scale of 1-5 where 1 is \"poor\" health, 2 is \"fair\", 3 is \"good\", 4 is \"very good\", and 5 is \"excellent\".", locations = cells_body(column = general_health))
nhanes_tbl
```

### Exercise 1

Run `nhanes` to load in the data set.

```{r nhanes-1, exercise = TRUE}

```

```{r nhanes-1-hint-1, eval = FALSE}
nhanes
```

### 

We don't know what any of this data is yet.

### Exercise 2

Run `?nhanes` data set to get more information about it.

```{r nhanes-2, exercise = TRUE}

```

```{r nhanes-2-hint-1, eval = FALSE}
?nhanes
```

### 

From this we learn that `nhanes` contains data from The National Health and Nutrition Examination Survey (NHANES) research survey. The survey examines health and nutritional status nationwide.

### Exercise 3

Start a pipe with `nhanes`. Continue the pipe to `filter()` so that the data only contains rows where `year` is `2011`, `gender` is `"Female"`, `age` is greater than `40`, and `race` is `"Mexican"`.

```{r nhanes-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-3-hint-1, eval = FALSE}
nhanes %>% 
  filter(survey == ..., gender == "...", age > ..., race == "...")
```

### 

These restrictions were chosen arbitrarily so that our end table is of manageable size.

### Exercise 4

Continue the pipe with `drop_na()` to drop all the rows with any missing values

```{r nhanes-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-4-hint-1, eval = FALSE}
... %>% 
  drop_na()
```

### 

`nhanes` is a unique data set as the surveyors conducts both interviews and physical examination to produce their data.

### Exercise 5

Continue the pipe and `select()` the `hh_income`, `age`, `sleep`, `general_health` columns.

```{r nhanes-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-5-hint-1, eval = FALSE}
... %>% 
  select(..., ..., ..., ...)
```

### 

The survey is run by the National Center for Health Statistics (NCHS), a part of the Centers for Disease Control and Prevention.


### Exercise 6

Continue the pipe and `arrange()` the data by `age`.

```{r nhanes-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-6-hint-1, eval = FALSE}
... %>% 
  arrange(...)
```

### Exercise 7

Continue the pipe and `arrange()` the data by `hh_income`

```{r nhanes-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-7-hint-1, eval = FALSE}
... %>% 
  arrange(...)
```

### 

The reason why we arranged the data twice is so that the second column is also aesthetically pleasing and easy to understand.

### 

What you have at this point should look like this:

```{r}
nhanes %>% 
  filter(survey == 2011, gender == "Female", age > 40, race == "Mexican") %>% 
  drop_na() %>%
  select(hh_income, age, sleep, general_health) %>% 
  arrange(age) %>% 
  arrange(hh_income)
```

### Exercise 8

Continue the pipe with `gt()`

```{r nhanes-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-8-hint-1, eval = FALSE}
... %>% 
  gt()
```

### 

This created a basic table from our manipulated data



### Exercise 9

add a `title` and `subtitle` using the `tab_header()` function. Remember that to bold the title you need to use the `md()` function

```{r nhanes-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-9-hint-1, eval = FALSE}
the code to bold text using md() is adding `**` to both ends of the string
```

```{r nhanes-9-hint-2, eval = FALSE}
... %>% 
  tab_header(title = "**...**",
             subtitle = "...")
```

### Exercise 10

Continue the pipe to add labels for the columns. Use `col_label()` and change the labels for `hh_income`, `age`, `sleep`, `general_health`. 

```{r nhanes-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-10-hint-1, eval = FALSE}
... %>% 
  cols_label(hh_income = ...,
             age = ...,
             sleep = ...,
             general_health = ...)
```

### Exercise 11

Continue the pipe to add a footnote (using `tab_footnote()`) which will indicate how `general_health` is ranked. assign the footnote to the `footnote` parameter, and assign the `cells_body()` function to location. Within `cells_body()` set the column to `general_health`. This adds the footnote to all the values within `general_health`.

```{r nhanes-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-11-hint-1, eval = FALSE}
To make quotation marks appear, add a "\" before the "
```

```{r nhanes-11-hint-2, eval = FALSE}
... %>% 
  tab_footnote(footnote = "...",
               locations = cells_body(column = ...))
```

### 

The information added to the footnote was given when `?nhanes` was run



### Exercise 12

Continue the pipe to include the source of the data. use `tab_source_note()` and use  `md()` to italicize the source information.

```{r nhanes-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r nhanes-12-hint-1, eval = FALSE}
the code to italicize text using md() is adding `*` to both ends of the string
```

```{r nhanes-12-hint-2, eval = FALSE}
... %>% 
  tab_source_note(md("*...*"))
```

### 

<!-- Look into themes to add -->

Congratulations, you should now have created a table that looks like this:

```{r}
nhanes_tbl
```

## regression tables

**gtsummary** is a package that can be used to summerize data and tibbles and is useful in creating regression tables.

### 

## reactable

### 

```{r download-answers, child = "../../child_documents/download_answers.Rmd"}
```
