---
title: Tables
tutorial:
  id: tables
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: Learn to make cool tables
---

```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(primer.data)
library(knitr)
library(gt)
library(skimr)
knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 
```

```{r copy-code-chunk, child = "../../child_documents/copy_button.Rmd"}
```

```{r info-section, child = "../../child_documents/info_section.Rmd"}
```

<!-- Make a new tutorial which is "tables": https://ppbds.github.io/primer/tools.html#how-to-make-a-table. https://gt.rstudio.com/. First section should show how to make tables with knitr::kable(). Do it like distill package. Pull out table questions from distill and put them here. (You need to clean up distill, renumber exercises and so on. The Tables and Images section becomes just Images.) Make sure you have students do something to prove that they have followed the steps. Last section should be a brand new, start from scratch repo all the way to R pubs which makes a nice table. Take a look at RStudio and Friends tutorial. Interesting: -->

<!-- https://themockup.blog/posts/2020-05-16-gt-a-grammer-of-tables/ -->
<!-- https://themockup.blog/posts/2020-09-04-10-table-rules-in-r/ -->


<!-- Pick another package (beyond kable and gt) which specializes in interactive tables. Create a Section which uses it. Maybe https://themockup.blog/posts/2020-05-13-reactable-tables-the-rest-of-the-owl/.  Done.-->


## Kable

### 

The `knitr` package gives the tools to embed tables into a website. There are also other packages which can render tables with different features. 

### Exercise 1

Start a pipe with the `mtcars` data set. Arrange this by `mpg` in ascending order. 

```{r kable-1, exercise = TRUE}

```

```{r kable-1-hint-1, eval = FALSE}
mtcars %>% 
  arrange(mpg)
```

### 

Notice that the first column, the name of the cars, does not have a column name. This is because it is not technically a column, but a **row name**. This is not the case with most of the data sets we work with (only data frames, not tibbles support it). 

### Exercise 2

In the other R Studio session, open index.Rmd. Create a new code chunk, name it table-1, and copy and paste your code from exercise 1 within it. Print the table and knit the document. 

### 

In the Terminal, run `tail index.Rmd`. Copy and paste the result below. 

```{r kable-2}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 3))
```

### 

This table looks similar to a console output. It could look a lot better. 



### Exercise 3

Let's add a table using the function `kable()`. It is part of the `knitr` package.  First, save the code above to an object called `table`. 

### 

In the setup chunk, load the library `knitr`. Save `index.Rmd`

### 

In the Terminal, run `grep library index.Rmd`. Copy and paste the result here.


```{r kable-3}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 3))
```

### 

This should return all the lines in which you load packages, including the most recent, `knitr`. 

### Exercise 4

Create a new code chunk named `table-2`.

### 

In that chunk run `kable(table)`. Knit the .Rmd. 

### 

In the Terminal, run `tail index.Rmd`. 

```{r kable-4}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 3))
```

### 

`kable` produces a compact and well-formatted tibble. 

### Exercise 5

Let's add a table using the function `paged_table()`. It is part of the `rmarkdown`. 

### 

In the setup chunk, load the library `rmarkdown`. Save `index.Rmd`

### 

In the Terminal, run `grep library index.Rmd`. Copy and paste the result here.


```{r kable-5}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 3))
```

### 

This should return all the lines in which you load packages, including the most recent, `rmarkdown`. 

### 

### Exercise 6

Create a new code chunk named `table-3`.

### 

In that chunk run `paged_table(table)`. Knit the .Rmd. 

### 

In the Terminal, run `tail index.Rmd`. 

```{r kable-6}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 3))
```

### 

`paged_table` produces a table similar to the R Markdown table output. Its chief advantage is that it allows for the table to have pages and take up less space. 

### Exercise 7

The table you just cannot display all of its columns in one window and so has a navigation arrow for the columns. There are two reasons for this: first, default maximum of columns printed with `paged_tables` is 10; second, the window in which Distill renders the table is too small. 

### 

Within your `paged_table` function, add `options(cols.print = 12)` as the second argument. Knit the .Rmd. 

### 

In the Terminal, run `grep options index.Rmd`. Copy and paste the result below. 

```{r kable-7}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 3))
```

### 

This tibble is even worse. YThe navigation arrow is still present and you need a horizantal scroller on the bottom to see it. 

### Exercise 8

To increase the width of the window in which Distill renders the graph, we can add options the setup chunk. After the chunk name add a comma and then the code `layout = "l-body-outset"`. 

### 

In the Terminal run the command `grep "r " index.Rmd`. This should return a list of all your code chunk headers, including the most recent one. Copy and paste the result below.

```{r kable-8}
question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = "Edit Answer",
    incorrect = NULL,
    options = list(nrows = 3))
```

### 

Now you should have a table which displays all twelve columns in one window. 

### 

For an even wider window for rendering objects in Distill, use `layout = "l-page"`. The layout command can be used for any object that Distill renders, including plots. 

### 

The command `datatable()` in the package `DT` allows for a paged table with even more user interaction. It allows the user to sort the table by variables and to search through the table. Here is an image of `mtcars` using the `DT` package function:

```{r}
include_graphics("images/datatable.png")
```

### 

While kable allows the creation of tables, customization of tables is limited when using this package. Instead we can use a different package that better suits our needs.

<!-- Research KableExtra -->

## gt

### 

Some other packages we can use to create tables are gt, reactable, DT, formattable, and flextable. gtsummary is a package that can be used to summerize data and tibbles and is useful in creating regression tables.

In this section we will learn about gt. Using gt you will be able to better tables. If you want to learn more about this package, check out https://gt.rstudio.com and Thomas Mock's blog. 

Thomas' blog can be found at https://themockup.blog . In This blog he covers a wide variety of data science topics. His posts on various tables are insightful. Check his blog out to be impressed!
 
### Exercise 1

### 

Load the **gt** library.

```{r gt-1, exercise = TRUE}

```

```{r gt-1-hint-1, eval = FALSE}
library(...)
```

### 

<!-- Drop some knowledge. -->

### Exercise 2

### 

Now run `?gt` to get more information about the `gt( )` function. This will give you an idea of what you need to make best use of this function.

```{r gt-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-2-hint-1, eval = FALSE}
library(...)
```

### 

Now let's make a table! the table we will make will end up looking like this:
```{r}
x <- trains %>%
  select(gender, income, att_end) %>%
  slice(1:5)
gt_obj1 <- x %>% 
  gt() %>%
    tab_header(title = md("**Enos Data Observations**"), 
               subtitle = "Gender, Income, and End Attitude from the Trains Data")%>%
    cols_label(gender = "Gender",
               income = "Income", 
               att_end = "End Attitude") %>% 
    tab_source_note(md("Source: Ryan Enos, *Causal Effect of Intergroup 
                       Contact on Exclusionary Attitudes*")) %>%
    fmt_currency(columns = c(income), 
                 decimals = 0) 
gt_obj1
```

### 

The data set that will be used to make this table is the trains data set which can be found in **primer.data**.

### Exercise 3

The first step is to load in the dataset.


```{r gt-3, exercise = TRUE}

```

```{r gt-3-hint-1, eval = FALSE}
trains
```

### 

This shows us the first 10 rows of the data set. At this point we do not know what any of the data means.

### Exercise 4

We should learn what the data set contains. We can do this by running `?trains`.

```{r gt-4, exercise = TRUE}

```

```{r gt-4-hint-1, eval = FALSE}
?trains
```

### 

From the description we learn that the data shows individuals' attitudes toward immigration-related policies, both before and after an experiment which randomly exposed a treated group to Spanish-speakers on a Boston commuter train platform.

### 

`?trains` isn't the only way to get more information about a data set. Some other functions are `glimpse(trains)`, `trains`, `summary(trains)`, `skim(trains)`, `View(trains)` and `?trains`. These commands have been ordered from least info to most info.

### Exercise 5

Start a pipe with the trains data set. Select the gender, income, and att_end columns.

```{r gt-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-5-hint-1, eval = FALSE}
... %>% 
  select(..., ..., ...)
```

### Exercise 6

Slice the tibble so that only the first 5 rows are displayed

```{r gt-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-6-hint-1, eval = FALSE}
... %>% 
  select(..., ..., ...) %>% 
  slice(...:...)
```

### 

### Exercise 6

Continue your pipe with gt( ).
```{r gt-ex-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-6-hint-2, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt()
```

### 

Your output should look like this:

```{r}
trains %>% 
  select(gender, income, att_end) %>%
  slice(1:5) %>% 
  gt()
```

### 

We now have a functional table. Let's make it look like the table we are aiming to make.

A reminder on how that table looks:

```{r}
gt_obj1
```

### Exercise 7

You can add a title and subtitle to the table by using `tab_header()`. Add a title and subtitle to your table.
```{r gt-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-7-hint-1, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = "...",
             subtitle = "...")
```

### 

What you have at this point should look like this:
```{r}
trains %>%
    select(gender, income, att_end) %>%
slice(1:5) %>% 
    gt() %>%
    tab_header(title = "Enos Data Observations", 
               subtitle = "Gender, Income, and End Attitude from the Trains Data")
```

### 

Notice how the title is not bold like it is in the table we want to recreate.

### Exercise 8

By default, titles and other text can not be formatted. To format them, wrap the character string in a call to md().

```{r gt-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-8-hint-1, eval = FALSE}
the code to bold text in md() is adding `**` to both ends of the string
```

```{r gt-8-hint-2, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...")
```

### Exercise 9

Change the column names using cols_label()
```{r gt-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-9-hint-1, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...") %>% 
  cols_label(... = "...",
             ... = "...",
             ... = "...")
```

### Exercise 10

Add a caption/cite your source using tab_source_note()

```{r gt-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-10-hint-1, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...") %>% 
  cols_label(... = "...",
             ... = "...",
             ... = "...") %>% 
  tab_source_note("...")
```

### Exercise 11

Part of the caption should be italicized. This can be done by wrapping the character string in a call to md()

```{r gt-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-11-hint-1, eval = FALSE}
The code to italicize text in md() is adding "*" to both ends of the string
```

```{r gt-11-hint-2, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...") %>% 
  cols_label(... = "...",
             ... = "...",
             ... = "...") %>% 
  tab_source_note(md("..., *...*"))
```

### Exercise 12

add dollar signs and commas to the income column using fmt_currency() (if you only want commas, you can use fmt_number()). Put income within c() to indicate that income is a currency, and assign a value of 0 to the decimals argument. Make sure that your table looks like the table we are aiming to make.
```{r gt-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r gt-12-hint-1, eval = FALSE}
... %>% 
  select(...,...,...) %>% 
  slice(...:...) %>% 
  gt() %>%
  tab_header(title = md("**...**"),
             subtitle = "...") %>% 
  cols_label(... = "...",
             ... = "...",
             ... = "...") %>% 
  tab_source_note(md("..., *...*")) %>% 
  fmt_currency(c(...), decimals = ...)
```

Remember, your final table should look like

```{r}
gt_obj1
```

## mtcars

###

## regression tables

###

## Reactable

###

```{r download-answers, child = "../../child_documents/download_answers.Rmd"}
```
