---
title: Distributions
tutorial:
  id: distributions
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: Practice working with and understanding distributions.
---

```{r setup, include = FALSE}
library(learnr)
library(primer.tutorials)
library(tidyverse)
library(primer.data)
knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 60, 
        tutorial.storage = "local") 
```

```{r copy-code-chunk, child = "../../child_documents/copy_button.Rmd"}
```

```{r info-section, child = "../../child_documents/info_section.Rmd"}
```

<!-- Add Introduction and Summary. See the new Template for discussion. -->

<!-- Re-read first page or two of Instructions. -->

<!-- Read Chapter 7 closely! Think about what it means. Your job in Chapter 5, and in this tutorial, is to ensure that students, when they get to chapter 7, understand it thoughly. In particular, questions 3 and 4 are solved by create, in each row, a draw from a joint distribution, and then manipulating that draw each time. And then (magically!), the results of that manipulation are also a posterior! Would a guided tour of rvar variable types in this chapter help to set the stage for that? Should we use rvar types in later chapters? -->

<!-- Define a distribution. A mathematical object with two components: a list of possible outcomes and a corresponding frequency for each outcome. In a normalized distribution, the sum of the frequencies is 1.  -->
<!-- Note that this is a sloppy definition because it does not apply to continuous distributions. Need to mention this and then wave our hands. -->

<!-- Define a random variable is "a variable whose values depend on outcomes of a random phenomenon." Example: Result of one coin flip. -->

<!-- Consider the posterior package: https://mc-stan.org/posterior/index.html. Need a new random variable object type: https://mc-stan.org/posterior/articles/rvar.html -->


<!-- Add to chapter 5 a tutorial whose sole focus is distributions. First part of this is going slowly through the process by which counts can be turned into percentages. Do this in, at least, five ways. First, with geom_bar() which (I think) does the counting for us. Second, with geom_col(), in which we need to create the counts ourselves. Third with geom_histogram(). Fourth then maybe create a histogram by hand, using cut() and then counting up the elements in each range. -->

<!-- Put the Appendix-distribution questions somewhere here. -->

<!-- Maybe have a section explaining how the distribution of the error term is what motivates the selection of the appropriate family argument in stan_glm(). -->

<!-- Need a section titled "Random variables". Purpose is to connect the concept/use of random variables to the concept/use of a distribution.  -->

## Introduction

###

Now first recall that a distribution is a mathematical object with two components: a list of possible outcomes and a corresponding frequency for each outcome or simply *the collection of data on a single variable*. 

Normalized distribution is essentially turning the frequency into percent, and which sum up equal to 1.


This tutorial has three missions:
1. Review key concepts and commands which frequently use in creating distributions.
2. Identify how statistics alter with different distributions.
3. 

Random variable :
Ways to map the outcomes of random processes to quantifiable numbers.




## Monte Hall
###

<!-- https://en.wikipedia.org/wiki/Monty_Hall_problem -->

<!-- Make a tibble. First time with just 5 rows so that you can see what is happening each time. Only at the end, do you make the tibble be 4,000 rows and then use summarize to calculate your answer or, maybe better, show a graph.  -->

<!-- First column is the random location of the goat. "1", "2" or "3". Second column is your random guess. Third column is which door Monte opens. (He can't open your door, nor can he open the door with the goat.) Then, two more columns: one with what happens if you switch (possible values "Goat" or "Car"), one with what happens if you don't switch. (Same possible values.)  -->

<!-- Create monte_p object. -->

<!-- Teach at beginning some simple vector manipulation like: -->

<!-- c(1, 2, 3)[! c(1,2,3) %in% 2] -->

<!-- Also teach them about doubles for versus integer and 3 versus 3L. -->

<!-- First show them door_with_car == 1 & door_chosen == 2 ~ 3 -->

<!-- Second, show them two lines: -->

<!--                   door_with_car == 1 & door_chosen == 2 ~ 3, -->
<!--                   door_with_car == 2 & door_chosen == 1 ~ 3, -->

<!-- Third, combine the two lines with: -->

<!-- all(c(door_with_car, door_choosen) %in% c(2, 1)) ~ 3 -->

<!-- Fouth, add other two cases like this: -->

<!-- all(c(door_with_car, door_choosen) %in% c(1, 3)) ~ 2 -->
<!-- all(c(door_with_car, door_choosen) %in% c(2, 13) ~ 1 -->

<!-- Fifth, show -->

<!-- door_with_car == 1 & door_chosen == 1 ~ sample(c(2, 3), size = 1)) -->

<!-- Six, show all three. And that completes the problem!  -->

<!-- Seventh (maybe), show how them something like: -->

<!-- door_with_car == door_chosen ~ sample(c(1, 2, 3)[! c(1,2,3) %in% door_choosen], size = 1)) -->

<!-- Replace "if_else(switch, ... case_when(" with just case_when(). -->
                          

```{r, echo = FALSE}
simNum <- 10  # Number of simulations
doorNum <- 3 

expand_grid(sim = 1:simNum, door = 1:doorNum) %>%
    group_by(sim) %>%
    mutate(guess = sample(c(0, 0, 1)), 
           car = sample(c(0, 0, 1))) %>%
  

  
    arrange(sim, -guess, car) %>%
    
    # row_number sim returns the row number *within* each sim grouping. This
    # only happens because we are still grouped by sim.
  
    mutate(switch = as.numeric(row_number(sim) == doorNum)) %>% print(n = 30)
    ungroup %>%
    summarise(stayWin = sum(guess*true)/simNum,
              switchWin = sum(switch*true)/simNum)
```

```{r, echo = FALSE}
monte_p <- expand_grid(sim = 1:10000, door = 1:3) %>%
  
    # my_vec <- c(TRUE, rep(FALSE, n_doors - 1))
  
    # Very handy to do stuff for each simulation separately. Don't forget to
    # ungroup() when you want to act on on the whole tibble at once.
  
    group_by(sim) %>%
  
    # sample() returns the whole vector, which is what we want since, in any
    # individual sim, the car is behind one of the three doors and exactly one
    # door is guessed initially.
  
    mutate(car = sample(c(FALSE, FALSE, TRUE))) %>%  
    mutate(guess = sample(c(FALSE, FALSE, TRUE))) %>% 

    
    # Convenient to always put the guessed door in the first row of each sim
    # group. Then have the actual location of the car as low in the sim group as
    # you can. This sort only matters in cases where the you did not guess the
    # car location. In those cases, you are always placing the car location as
    # the lowest row within the sim group.
  
    # sample_frac() to rearrnage the rows randomly, maybe.
  
    arrange(sim, -guess, car) %>% 
    mutate(row_n = row_number(sim)) %>%
    mutate(switch_to = row_n == 3) %>% 
    mutate(stay_win = if_else(guess & car, TRUE, FALSE)) %>% 
    mutate(switch_win = if_else(switch_to & car, TRUE, FALSE))  %>%  
  
    # Now, within each sim, we need to see if switch or stay won. They won if
    # there is at least one TRUE value for the stay_win (or switch_win) variable
    # calculated in the previous steps. So, we just need a max.

    summarise(stayWin = max(stay_win),
              switchWin = max(switch_win)) %>% 
    
    # For each sim, we now now if staying was a winning strategy and/or if
    # switching was a winning strategy. (With more than three doors, it will
    # often be the case that neither staying nor switching wins, like when you
    # switch from one empty door to the other.)
  
    ungroup() %>% 
  
   summarise(stayWin, switchWin) %>%
      
    
    pivot_longer(cols = everything(), 
               names_to = "decision", 
               values_to = "result") %>%
  ggplot(aes(x = result, fill = decision)) +
    geom_bar(aes(y = after_stat(count/sum(count))), position = 'dodge')+
  scale_x_continuous(breaks = c(0 , 1),
                   labels = c("Lose", "Win"))+
  scale_y_continuous(labels = 
                         scales::percent_format(accuracy = 1)) +
  scale_fill_discrete(labels = c("Stay", "Switch")) +
  labs(title = "Joint distribution of Monty Hall Problem",
       subtitle = "One will have better change of winning if switching door",
       x = "Results",
       y = "Probability",
       fill = "Decision")
  


  # Use to calculate the exact percentage.
# summarize(stay_odds = mean(stayWin),
    #           switch_odds = mean(switchWin)) %>%    
monte_p    
```

                          

### Exercise 1


```{r monte-hall-1, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-1-hint, eval = FALSE}

```

###

### Exercise 2


```{r monte-hall-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-2-hint, eval = FALSE}

```

###

### Exercise 3


```{r monte-hall-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-3-hint, eval = FALSE}

```

###

### Exercise 4



```{r monte-hall-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-4-hint, eval = FALSE}

```

###



### Exercise 5


```{r monte-hall-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-5-hint, eval = FALSE}

```

###

### Exercise 6


```{r monte-hall-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-6-hint, eval = FALSE}

```

###

### Exercise 7


```{r monte-hall-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-7-hint, eval = FALSE}

```

###

### Exercise 8


```{r monte-hall-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-8-hint, eval = FALSE}

```

###

### Exercise 9


```{r monte-hall-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-9-hint, eval = FALSE}

```

###

### Exercise 10


```{r monte-hall-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-10-hint, eval = FALSE}

```

###

### Exercise 11


```{r monte-hall-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-11-hint, eval = FALSE}

```

###

### Exercise 12


```{r monte-hall-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-12-hint, eval = FALSE}

```

###

### Exercise 13


```{r monte-hall-13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-13-hint, eval = FALSE}

```

###

### Exercise 14


```{r monte-hall-14, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-14-hint, eval = FALSE}

```

###

### Exercise 15


```{r monte-hall-15, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-15-hint, eval = FALSE}

```

###

### Exercise 16


```{r monte-hall-16, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r monte-hall-16-hint, eval = FALSE}

```

###




<!-- ## Two daughter puzzle -->
<!-- ### -->

<!-- Consider all the families in town with two children. All children are either boys or girls, each of which occur randomly with 50/50 odds. Pick a family with at least one girl at random. What are the chances that the other child is a girl? -->


<!-- ## Four children problem -->

<!-- All children are either boys or girls, each of which occur randomly with 50/50 odds. Consider families with 4 children. What combination of of genders (2 of each, 3 of 1 and 1 of the other, or all four the same) is most likely. -->




## Summary
###


```{r download-answers, child = "../../child_documents/download_answers.Rmd"}
```
